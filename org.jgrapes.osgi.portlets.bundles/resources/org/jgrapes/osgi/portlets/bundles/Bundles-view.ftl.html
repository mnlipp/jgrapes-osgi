<div data-portlet-title="${_("portletName")}" class="jgrapes-osgi-bundles-view">
  <div class="jgrapes-osgi-bundles-view-search">
    <form>
      ${_("Filter:")} <input type="search" v-on:input="controller.updateFilter($event)">
      <span role="button" class="jgportal-button-icon fas fa-backspace" 
        v-on:click="controller.clearFilter($event)"></span>
    </form>
  </div>
  <table class="jgportal-basic-table jgrapes-osgi-bundles-view-table">
    <thead>
      <tr>
        <th v-for="key in controller.keys"
          class="sortable" v-on:click="controller.sortBy(key)">
          {{ controller.label(key) }}<span v-if="controller.sortedByAsc(key)"
            role="button" class="jgportal-button-icon">&#x25B2;</span><span
            v-if="controller.sortedByDesc(key)" role="button" 
            class="jgportal-button-icon">&#x25BC;</span>
        </th>
        <th>
          ${_("bundleActions")}
        </th>
      </tr>
    </thead>
    <tbody>
      <tr v-for="entry in filteredData">
        <td v-for="key in ((entry.id in detailsById) ? ['id', 'name'] : controller.keys)" 
          v-bind:title="key == 'name' ? entry['symbolicName']: false"
          v-bind:colspan="(key == 'name') && (entry.id in detailsById) ? 5 : false">
          <span v-if="key != 'name'" v-html="controller.breakBeforeDots(entry[key])"></span>
          <template v-else>
            <template v-if="!(entry.id in detailsById)"> 
              <span role="button"
                class="jgportal-button-icon fas fa-caret-right"
                v-on:click="toggleDetails(entry.id)"></span>
              <span v-html="controller.breakBeforeDots(entry[key])"></span>
            </template>
            <div v-else style="display: flex; flex-direction: row;">
              <span role="button" style="margin-right: 0.5em;"
                class="jgportal-button-icon fas fa-caret-down"
                  v-on:click="toggleDetails(entry.id)"></span>
              <table>
                <tr>
                  <td>{{ controller.label('name') }}</td>
                  <td><span v-html="controller.breakBeforeDots(entry['name'])"></span></td>
                </tr>
                <tr v-for="detail in detailsById[entry.id]">
                  <td>{{ detail[0] }}</td>
                  <td v-if="detail[2] == 'table'">
                    <table>
                      <tr v-for="row in detail[1]">
                        <td v-html="controller.breakBeforeDots(row[0])"></td>
                        <td v-if="/.*-Package/i.test(row[0])"
                          v-html="addManifestValueBreaks(row[1])"></td>
                        <td v-else
                          v-html="controller.breakBeforeDots(row[1])"></td>
                      </tr>
                    </table>
                  </td>
                  <td v-else-if="detail[2] == 'dateTime'"><span v-html="formatDateTime(detail[1])"></span></td>
                  <td v-else><span v-html="detail[1]"></span></td>
                </tr>
              </table>
            </div>
          </template>
        </td>
        <td  v-if="!(entry.id in detailsById)"
          class="jgrapes-osgi-bundles-view-action-list">
          <span role="button" v-if="entry.startable" 
            class="jgportal-button-icon fas fa-play" title="${_("bundleStart")}"
            v-on:click="bundleAction(entry.id, 'start')"></span>
          <span role="button" v-if="entry.stoppable"
            class="jgportal-button-icon fas fa-stop" title="${_("bundleStop")}"
            v-on:click="bundleAction(entry.id, 'stop')"></span>
          <span role="button" class="jgportal-button-icon fas fa-sync"
            title="${_("bundleUpdate")}"
            v-on:click="bundleAction(entry.id, 'update')"></span>
          <span role="button" class="jgportal-button-icon fas fa-eject"
            title="${_("bundleUninstall")}"
            v-bind:disabled="!entry.uninstallable"
            v-on:click="bundleAction(entry.id, 'uninstall')"></span>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<script>
	orgJGrapesOsgiPortletsBundles.initViewTable("${portlet.portletId}");
</script>
