<div class="jgrapes-osgi-logviewer-view"
  data-jgwc-on-load="orgJGrapesOsgiConletLogViewer.initView"
  data-jgwc-on-unload="orgJGrapesOsgiConletLogViewer.onUnload">
  <div class="jgrapes-osgi-logviewer-control">
	<form class="flow-content--paragraph">
	  <fieldset class="form__fieldset--horizontal form__fieldset--panel">
		<span>
		  <legend>${_("Update")}</legend>
		    <span>
			  <label>
			    <input type="checkbox" v-model="autoUpdate">
				  <span>${_("auto")}</span>
			  </label>
		    <span role="button" class="jgrapes-osgi-logviewer-reload fas fa-sync"
			  v-on:click="resync($event)">
		   </span>
		  </span>
	    </span>
	  </fieldset>

      <label class="form__label--horizontal jgrapes-osgi-logviewer-level">
        <span>${_("severityAtLeast")}</span>
        <select v-model="messageThreshold">
          <option value="AUDIT">${_("AUDIT")}</option>
          <option value="ERROR">${_("ERROR")}</option>
          <option value="WARN">${_("WARN")}</option>
          <option value="INFO">${_("INFO")}</option>
          <option value="DEBUG">${_("DEBUG")}</option>
          <option value="TRACE">${_("TRACE")}</option>
        </select>
      </label>

      <label class="form__label--horizontal">
        <span>${_("Filter")}</span>
        <input type="search" v-on:input="controller.updateFilter($event)">
        <span class="form-item">
          <span role="button" class="fas fa-backspace" 
            v-on:click="controller.clearFilter($event)"></span>
        </span>
      </label>
    </form>
  </div>
  <table class="table--basic table--basic--striped jgrapes-osgi-logviewer-table">
    <thead>
      <tr>
        <th v-for="key in controller.keys"
          class="sortable" 
          v-on:click="controller.sortBy(key === 'time' ? 'sequence' : key)">
          {{ controller.label(key) }}<span 
            v-if="controller.sortedByAsc(key === 'time' ? 'sequence' : key)"
            role="button">&#x25B2;</span><span
            v-if="controller.sortedByDesc(key === 'time' ? 'sequence' : key)"
            role="button">&#x25BC;</span>
        </th>
      </tr>
    </thead>
    <tbody>
      <template v-for="(entry, rowIndex) in filteredData">
        <tr :class="[(rowIndex % 2) ? 'odd' : 'even']">
          <template v-for="key in controller.keys">
            <td v-if="key === 'time'" 
              :class="'jgrapes-osgi-logviewer-' + key"
              v-html="formatTimestamp(entry[key])">
            </td>
            <td v-else-if="key === 'exception'" 
              :class="'jgrapes-osgi-logviewer-' + key">
              <aash-disclosure-button v-if="entry['stacktrace']"
                v-bind:id-ref="scopedId(rowIndex)">
                <span v-html="entry[key]"></span>
              </aash-disclosure-button>
            </td>
            <td v-else
              :class="'jgrapes-osgi-logviewer-' + key"
              v-html="entry[key]">
            </td>
          </template>
        </tr>
        <tr :id="scopedId(rowIndex)" v-if="$aash.isDisclosed(scopedId(rowIndex))" 
          :class="[(rowIndex % 2) ? 'odd' : 'even']">
          <td colspan="6" class="jgrapes-osgi-logviewer-stacktrace">
            <div v-html="entry['stacktrace']"></div>
          </td>
        </tr>
      </template>
    </tbody>
  </table>
</div>
